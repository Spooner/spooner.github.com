!!! XML
!!!

%html{ xmlns: "http://www.w3.org/1999/xhtml", "xml:lang" => "en", lang: "en" }
  %head
    %meta{ "http-equiv" => "Content-Type", content: "text/html; charset=UTF-8" }
    %meta{ charset: "UTF-8" }
    %meta{ name: "generator", content: "nanoc 3.2.3" }
    - %w[stylesheet code_highlighting].each do |stylesheet|
      %link{ rel: "stylesheet", type: "text/css", href: "/style/#{stylesheet}.css", media: "screen" }

    %link{ href: '/blog/feed.xml', rel: 'alternate', title: "Spooner's Blog", type: 'application/atom+xml' }
    %title= "Spooner - #{@item[:title]}"


  %body
    %div.description
      %a{ href: '/' }
        %img.banner_left{ src: "/images/spooner_pixels_large.png", width: "128", height: "128", alt: "Actual photo of Spooner" }
      %a{ href: '/' }
        %img.banner_right{ src: "/images/bagpuss_large.png", width: "128", height: "128", alt: "Bagpuss" }

      %h1
        %a{ href: "/" } Spooner

    %div.breadcrumbs
      - if @item.identifier == '/'
        &nbsp;
      - else
        = breadcrumbs_trail.map {|crumb| link_to(crumb[:title], crumb.rep_named(:default)) }.join(" &raquo; ")

    %div{ class: "col_mask right_menu" }
      %div.col_left
        %div.contents_wrap
          %div.contents

            - unless @item.identifier == '/'
              %h2 #{@item[:title]}

            = yield

        %div.sidebar
          %ul
            %li{ style: "margin-bottom:1em;" }
              - if @item.identifier == '/'
                %span Home
              - else
                = link_to "Home", '/'

            - @base_item = @item
            - @base_item = @base_item.parent while @base_item.parent
            - @base_item.children.select {|i| i[:title] }.each do |item|

              %li
                - if item == @item
                  %span= item[:title]
                - else
                  = link_to item[:title], item.identifier

                %ul
                  -
                  - if item.identifier == '/blog/'
                    - items = item.children.select {|i| i[:kind] == 'year' }.reverse
                    - items << item.children.find {|i| i.identifier =~ /tags/ }
                    - items.each do |item|
                      %li
                        - if item == @item
                          #{item[:title]} (#{item.children.size})
                        - else
                          = link_to "#{item[:title]} (#{item.children.size})", item.identifier
                  - else
                    - item.children.each do |item|
                      %li
                        - if item == @item
                          = item[:title]
                        - else
                          = link_to item[:title], item.identifier


    %div.footer
      %p
        Today, Spooner was brought to you by the letter 'oo'<br />
        bil dot bagpuss {at} gmail dot com